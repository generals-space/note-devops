# bridge+vlanå®éªŒ.01.æ•°æ®æµå…¥none

æ¢å¤å¼•è¨€ä¸­çš„å®éªŒç½‘ç»œ, å¼€å¯ bridge çš„ vlan è¿‡æ»¤åŠŸèƒ½.

```
ip netns exec ns03 ip link set dev mybr0 type bridge vlan_filtering 1
```

## ä¸å¸¦ vlan tag çš„æ•°æ®åŒ…å°†è¢«ä¸¢å¼ƒ

åœ¨`ns03`æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤

```
$ bridge vlan del dev veth31 vid 1
$ bridge vlan show
port	vlan ids
veth31	None
veth32	 1 PVID Egress Untagged
mybr0	 1 PVID Egress Untagged
```

æ­¤æ—¶ç½‘ç»œæ‹“æ‰‘ä¸å˜, åªæ˜¯ bridge ä¸Šçš„æ¥å£æ ‡è®°å‘ç”Ÿçš„å˜åŠ¨, `ns01`ä¸`ns02`æ˜¯ä¸é€šçš„.

ä»`ns01`ä¸­ping 10.1.1.4, æ•°æ®åŒ…æµå‘: veth11 -> veth31 -ğŸš«> mybr0 -> veth32 -> veth22

åœ¨mybr0ä¸ŠæŠ“åŒ…, æ²¡æœ‰æ•°æ®, è¯´æ˜è¢« bridge è®¾å¤‡ä¸¢å¼ƒäº†.

## å¸¦æœ‰ vlan tag çš„æ•°æ®åŒ…ä¹Ÿè¢«ä¸¢å¼ƒ

ä» veth11 æ¥å£åˆ›å»º vid 1 çš„ vlan è®¾å¤‡, å¹¶å°† veth11 çš„ IP ç§»äº¤ç»™è¯¥ vlan è®¾å¤‡.

```
ip netns exec ns01 ip link add link veth11 name veth11.1 type vlan id 1
ip netns exec ns01 ip addr del 10.1.1.3/24 dev veth11
ip netns exec ns01 ip r flush dev veth11
ip netns exec ns01 ip addr add 10.1.1.3/24 dev veth11.1
ip netns exec ns01 ip link set veth11.1 up
```

è¿™æ ·å‘å‡ºçš„æ•°æ®åŒ…å°±ä¼šå¸¦æœ‰ vid 1 çš„ vlan tag äº†.

æ­¤æ—¶ç½‘ç»œæ‹“æ‰‘å¦‚ä¸‹

```
+-------------------------------+-------------------------------------------------------+
|              netns1           |                  netns3                 |   netns2    |
|  10.1.1.1/24                  |                                         | 10.1.1.2/24 |
|  +----------+      +-------+  |  +-------+     +-------+     +-------+  |  +-------+  |
|  | veth11.1 â”œâ”€â”€â”€â”€â”€â”€â”¤ veth11|  |  |veth31 | <-> | mybr0 | <-> | veth32|  |  | veth22|  |
|  +----------+      +---â†‘---+  |  +---â†‘---+     +-------+     +----â†‘--+  |  +--â†‘----+  |
|      vlan              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       |
+-------------------------------+-----------------------------------------+-------------+
```

ä½†ä»ç„¶æ˜¯ä¸é€šçš„, mybr0ä¸ŠæŠ“åŒ…, è¿˜æ˜¯æ²¡æ•°æ®.

æ³¨æ„: æœ¬æ¬¡å®éªŒåªè®¨è®ºæ•°æ®åŒ…æµå…¥ None ç±»å‹æ¥å£çš„æƒ…å†µ, æ‰€ä»¥æ­¤æ—¶ä» 10.1.1.4 å¤„åå‘ ping 10.1.1.3 çš„æ•°æ®åŒ…æµå‘æœªä½œè®¨è®º.
