# YUM为我们做了什么?

## 1. 情境

源码安装的步骤一般为:

```
./configure [配置选项]
make //编译
make install //安装
```

以Apache的安装为例

### 1.1 依赖关系

`./configure`时不去指定任何配置参数(除了三个依赖软件, 需要在参数中指明路径)

Apache安装依赖于`apr`, `apr-util`与`pcre`, 需要下载后各自安装, 编译Apache时指明这三个软件的安装目录.

### 1.2 目录结构

源码安装后, 安装目录(默认是/usr/local/apache2)下包含了如下文件或目录:

|                   |                                                                  |
| :---------------- | :--------------------------------------------------------------- |
| bin               | 可执行文件目录                                                   |
| conf              | 配置文件目录                                                     |
| htdocs            | 网站文档根目录                                                   |
| include           | 模块头文件目录                                                   |
| logs              | 日志文件目录                                                     |
| man               | man手册目录(此时没有办法使用man命令直接查到Apache提供的手册信息) |
| manual            | Apache使用手册目录(与官方文档一致)                               |
| modules           | 模块目录(编译产生的so文件)                                       |
| /usr/lib64/httpd/ | Apache核心需要的so文件, 并未与上述文件在同一目录                 |

其中`conf`, `htdocs`, `logs`这些可以Apache在运行之前由`httpd.conf`文件指定(不过在Apache启动时需要指定配置文件路径), 暂且不论. 其他目录则只能在编译时指定了.

而yum或是rpm安装时, 配置文件一般置于`/etc`, 可执行文件在`/usr/bin`, 依赖的共享库在`/usr/lib`或`/usr/lib64`等, 相应的man手册与系统服务也会自动添加.

## 2. 分析

层层分析由源码到rpm包再到yum在线安装机制如何使安装变得简单.

### 2.1 软件官方发布源码

用户需要自行下载源码包及依赖包, configure时指定依赖包的安装路径, 然后编译安装;

如果依赖包的编译安装也需要其他依赖包, 这是噩梦难度;

### 2.2 rpm软件管理机制

首先发行版厂商上约定了软件安装时不同作用的目录的路径;

(软件官方或是第三方)根据不同发行版进行编译打包, 按照约定的配置完成configure并编译打包成rpm文件. 注意: 当时的编译环境必然已经安装好了依赖软件, 解决了依赖关系, 否则编译时不会成功.

在rpm机制管理下, 所有用户的软件的安装结构都遵循发行版约定, 所以目标rpm将会在与编译环境相同的路径下寻找依赖软件. 简要说来就是, 安装路径的配置是为了更方便的解决依赖.

安装rpm时, 配置文件, man手册, 依赖的共享库等(如果有的话), 都由rpm机制记录在数据库中.

但问题是, 用户在本地安装时并不一定安装有这些依赖, 依然需要手动解决.

### 2.3 yum最大的好处就是解决了包依赖

yum安装将查询下载所有依赖的rpm包, 这些包的安装/配置路径都符合RedHat/CentOS系的约定, 所以安装时不会出现找不到依赖包的情况.
